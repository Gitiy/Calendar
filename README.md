# Calendar å›¾ç‰‡ä¸‹è½½å™¨

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ‰¹é‡å›¾ç‰‡ä¸‹è½½å·¥å…·ï¼Œæ”¯æŒä»æŒ‡å®šèµ·å§‹æ—¥æœŸå¼€å§‹è‡ªåŠ¨ä¸‹è½½æ¯æ—¥å›¾ç‰‡ï¼Œå¹¶æ™ºèƒ½ä¿®æ”¹ç…§ç‰‡çš„ EXIF ä¿¡æ¯å’Œæ–‡ä»¶æ—¶é—´æˆ³ã€‚

## âœ¨ ç‰¹æ€§

- ğŸš€ **æ‰¹é‡ä¸‹è½½**ï¼šæ”¯æŒä»æŒ‡å®šæ—¥æœŸåˆ°å½“å‰æ—¥æœŸçš„æ‰¹é‡ä¸‹è½½
- ğŸ”„ **è‡ªåŠ¨é‡è¯•**ï¼šå†…ç½®æ™ºèƒ½é‡è¯•æœºåˆ¶ï¼Œç½‘ç»œä¸ç¨³å®šæ—¶è‡ªåŠ¨é‡è¯•
- ğŸ¯ **å¹¶å‘æ§åˆ¶**ï¼šå¯é…ç½®æœ€å¤§å¹¶å‘æ•°ï¼Œä¼˜åŒ–ä¸‹è½½é€Ÿåº¦
- ğŸ“… **æ™ºèƒ½æ—¥æœŸç®¡ç†**ï¼šä¸‹è½½æˆåŠŸåè‡ªåŠ¨æ›´æ–°é…ç½®æ–‡ä»¶ä¸­çš„èµ·å§‹æ—¥æœŸ
- ğŸ·ï¸ **EXIF ä¿®æ”¹**ï¼šè‡ªåŠ¨è®¾ç½®å›¾ç‰‡çš„ DateTimeOriginal ç­‰å…ƒæ•°æ®
- ğŸ“ **æ™ºèƒ½æ–‡ä»¶å‘½å**ï¼šæ”¯æŒè‡ªå®šä¹‰æ–‡ä»¶åæ ¼å¼ï¼ŒæŒ‰å¹´ä»½è‡ªåŠ¨å½’æ¡£
- ğŸ“Š **è¿›åº¦æ˜¾ç¤º**ï¼šå®æ—¶æ˜¾ç¤ºä¸‹è½½è¿›åº¦å’Œç»Ÿè®¡ä¿¡æ¯
- ğŸ› ï¸ **çµæ´»é…ç½®**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶è½»æ¾ç®¡ç†å„é¡¹å‚æ•°

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Rust 1.70 æˆ–æ›´é«˜ç‰ˆæœ¬
- æ“ä½œç³»ç»Ÿï¼šLinuxã€macOSã€Windows

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone <repository-url>
cd calendar

# ç¼–è¯‘å‘å¸ƒç‰ˆæœ¬
cargo build --release

# äºŒè¿›åˆ¶æ–‡ä»¶ä½äº target/release/calendar
```

### 2. é…ç½®

åˆ›å»º `config.toml` é…ç½®æ–‡ä»¶ï¼š

```toml
# èµ·å§‹æ—¥æœŸ (æ ¼å¼ï¼šYYYY-MM-DD)
start_date = "2024-01-01"

# åŸºç¡€ URLï¼Œæ”¯æŒå ä½ç¬¦
base_url = "https://example.com/images/{year}/{month:02}/{day:02}.jpg"

# è¾“å‡ºç›®å½•
output_dir = "./images"

# æ–‡ä»¶åæ ¼å¼
filename_format = "{yyyy}{mm}{dd}.jpg"

# æœ€å¤§å¹¶å‘æ•°
max_concurrent = 5

# ä¸‹è½½è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
timeout = 30

# æœ€å¤§é‡è¯•æ¬¡æ•°
max_retries = 3

# é‡è¯•åŸºç¡€å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
retry_delay_ms = 1000

# User-Agent
user_agent = "Mozilla/5.0"
```

### 3. ä½¿ç”¨

```bash
# ä»é…ç½®æ–‡ä»¶ä¸­çš„èµ·å§‹æ—¥æœŸå¼€å§‹ä¸‹è½½åˆ°ä»Šå¤©
./target/release/calendar run

# æŒ‡å®šèµ·å§‹å’Œç»“æŸæ—¥æœŸ
./target/release/calendar run --start-date 2024-01-01 --end-date 2024-12-31

# å¤„ç†ç‰¹å®šæ—¥æœŸ
./target/release/calendar process --date 2024-06-15

# å¤„ç†å¤šä¸ªæ—¥æœŸ
./target/release/calendar process --dates 2024-06-15,2024-06-20,2024-06-25

# è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶
./target/release/calendar run --overwrite

# ä»…ä¸‹è½½ä¸ä¿®æ”¹å…ƒæ•°æ®
./target/release/calendar run --download-only

# ä»…ä¿®æ”¹å…ƒæ•°æ®ä¸ä¸‹è½½
./target/release/calendar process --dates 2024-06-15 --metadata-only

# è®¾ç½®æ—¥å¿—çº§åˆ«
./target/release/calendar -l debug run
```

## ğŸ“– å‘½ä»¤è¯¦è§£

### run å‘½ä»¤

æ‰¹é‡ä¸‹è½½ä»èµ·å§‹æ—¥æœŸåˆ°ç»“æŸæ—¥æœŸçš„æ‰€æœ‰å›¾ç‰‡ã€‚

```bash
calendar run [OPTIONS]
```

**é€‰é¡¹ï¼š**
- `-c, --config <FILE>` - é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ï¼šconfig.tomlï¼‰
- `-l, --log-level <LEVEL>` - æ—¥å¿—çº§åˆ«ï¼štrace, debug, info, warn, error
- `--start-date <DATE>` - èµ·å§‹æ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
- `--end-date <DATE>` - ç»“æŸæ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
- `--overwrite` - è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶
- `--download-only` - ä»…ä¸‹è½½ï¼Œä¸ä¿®æ”¹ EXIF å’Œæ–‡ä»¶å±æ€§

**è¡Œä¸ºè¯´æ˜ï¼š**
- å¦‚æœæœªæŒ‡å®š `--start-date`ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„ `start_date`
- å¦‚æœæœªæŒ‡å®š `--end-date`ï¼Œé»˜è®¤ä¸‹è½½åˆ°å½“å‰æ—¥æœŸ
- ä¸‹è½½æˆåŠŸåï¼Œä¼šè‡ªåŠ¨æ›´æ–°é…ç½®æ–‡ä»¶ä¸­çš„ `start_date` ä¸ºæœ€æ–°æˆåŠŸçš„æ—¥æœŸ
- å·²å­˜åœ¨çš„æ–‡ä»¶é»˜è®¤ä¼šè·³è¿‡ï¼Œä½†ä»ç„¶æ›´æ–° EXIF å’Œæ–‡ä»¶å±æ€§ï¼ˆé™¤éä½¿ç”¨ `--download-only`ï¼‰

### process å‘½ä»¤

å¤„ç†æŒ‡å®šæ—¥æœŸçš„å•ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ã€‚

```bash
calendar process [OPTIONS]
```

**é€‰é¡¹ï¼š**
- `--date <DATE>` - å•ä¸ªæ—¥æœŸ
- `--dates <DATES>` - å¤šä¸ªæ—¥æœŸï¼Œé€—å·åˆ†éš”æˆ–å¤šæ¬¡æŒ‡å®š
- `--overwrite` - è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶
- `--metadata-only` - ä»…ä¿®æ”¹ EXIF å’Œæ–‡ä»¶å±æ€§ï¼Œä¸ä¸‹è½½

**è¡Œä¸ºè¯´æ˜ï¼š**
- å¿…é¡»æŒ‡å®š `--date` æˆ– `--dates` å‚æ•°
- ä¸ä½¿ç”¨å¹¶å‘ï¼Œé€ä¸ªå¤„ç†æ—¥æœŸ
- é€‚åˆå¤„ç†ç‰¹å®šæ—¥æœŸæˆ–ä¿®å¤å¤±è´¥çš„ä¸‹è½½

## âš™ï¸ é…ç½®è¯¦è§£

### å ä½ç¬¦è¯´æ˜

é…ç½®æ–‡ä»¶ä¸­çš„ URL å’Œæ–‡ä»¶åæ ¼å¼æ”¯æŒä»¥ä¸‹å ä½ç¬¦ï¼š

| å ä½ç¬¦ | è¯´æ˜ | ç¤ºä¾‹ | è¾“å‡º |
|--------|------|------|------|
| `{year}` | å››ä½å¹´ä»½ | 2024 | 2024 |
| `{month}` | æœˆä»½ï¼ˆä¸è¡¥ä½ï¼‰ | 6 | 6 |
| `{month:02}` | æœˆä»½ï¼ˆè¡¥ä½ï¼‰ | 6 | 06 |
| `{day}` | æ—¥æœŸï¼ˆä¸è¡¥ä½ï¼‰ | 5 | 5 |
| `{day:02}` | æ—¥æœŸï¼ˆè¡¥ä½ï¼‰ | 5 | 05 |
| `{yyyy}` | å››ä½å¹´ä»½ | 2024 | 2024 |
| `{yy}` | ä¸¤ä½å¹´ä»½ | 2024 | 24 |
| `{mm}` | ä¸¤ä½æœˆä»½ | 6 | 06 |
| `{dd}` | ä¸¤ä½æ—¥æœŸ | 5 | 05 |

### é…ç½®é¡¹è¯´æ˜

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `start_date` | String | - | èµ·å§‹æ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD |
| `base_url` | String | - | å›¾ç‰‡ URL æ¨¡æ¿ï¼Œæ”¯æŒå ä½ç¬¦ |
| `output_dir` | String | - | è¾“å‡ºç›®å½•è·¯å¾„ |
| `filename_format` | String | - | æ–‡ä»¶åæ ¼å¼ï¼Œæ”¯æŒå ä½ç¬¦ |
| `max_concurrent` | Integer | 3 | æœ€å¤§å¹¶å‘ä¸‹è½½æ•° |
| `timeout` | Integer | 30 | ä¸‹è½½è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ |
| `max_retries` | Integer | 3 | æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆ0 ä¸ºç¦ç”¨ï¼‰ |
| `retry_delay_ms` | Integer | 1000 | é‡è¯•åŸºç¡€å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰ |
| `user_agent` | String | Mozilla/5.0 | HTTP è¯·æ±‚ User-Agent |

### ç¯å¢ƒå˜é‡

å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡è¦†ç›–é…ç½®ï¼š

```bash
export CALENDAR_USER_AGENT="CustomAgent/1.0"
export CALENDAR_TIMEOUT="60"

./target/release/calendar run
```

## ğŸ“‚ æ–‡ä»¶ç»„ç»‡

ä¸‹è½½çš„æ–‡ä»¶ä¼šæŒ‰å¹´ä»½è‡ªåŠ¨ç»„ç»‡ï¼š

```
output_dir/
â”œâ”€â”€ 2024/
â”‚   â”œâ”€â”€ 20240101.jpg
â”‚   â”œâ”€â”€ 20240102.jpg
â”‚   â””â”€â”€ ...
â”œâ”€â”€ 2025/
â”‚   â”œâ”€â”€ 20250101.jpg
â”‚   â””â”€â”€ ...
```

## ğŸ› é”™è¯¯å¤„ç†

### å¤±è´¥çš„ä¸‹è½½

å¤±è´¥çš„ä¸‹è½½ä¼šè¢«è®°å½•åˆ° `output_dir/failed_downloads.txt` æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é‡æ–°å¤„ç†ï¼š

```bash
# æŸ¥çœ‹å¤±è´¥çš„æ—¥æœŸ
cat images/failed_downloads.txt

# é‡æ–°å¤„ç†å¤±è´¥çš„æ—¥æœŸ
./target/release/calendar process --dates $(cat images/failed_downloads.txt | tr '\n' ',')
```

### é‡è¯•æœºåˆ¶

ç¨‹åºå†…ç½®æ™ºèƒ½é‡è¯•æœºåˆ¶ï¼š
- é»˜è®¤æœ€å¤šé‡è¯• 3 æ¬¡
- ä½¿ç”¨æŒ‡æ•°é€€é¿ç­–ç•¥ï¼ˆ1s, 2s, 4s...ï¼‰
- å¯¹ä»¥ä¸‹é”™è¯¯è‡ªåŠ¨é‡è¯•ï¼š
  - ç½‘ç»œè¶…æ—¶
  - è¿æ¥é”™è¯¯
  - DNS è§£æå¤±è´¥
  - æœåŠ¡å™¨é”™è¯¯ï¼ˆ5xxï¼‰
  - HTTP 429ï¼ˆToo Many Requestsï¼‰
- ä»¥ä¸‹é”™è¯¯ä¸é‡è¯•ï¼š
  - 404 Not Found

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

Release ç‰ˆæœ¬å·²é’ˆå¯¹ä½“ç§¯è¿›è¡Œä¼˜åŒ–ï¼š
- äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°ï¼šçº¦ 4.9MB
- ä½¿ç”¨ LTOï¼ˆé“¾æ¥æ—¶ä¼˜åŒ–ï¼‰
- ç§»é™¤è°ƒè¯•ç¬¦å·
- ç²¾ç®€ tokio features

### è‡ªå®šä¹‰ç¼–è¯‘

å¦‚éœ€è¿›ä¸€æ­¥ä¼˜åŒ–ç¼–è¯‘ï¼š

```bash
# å¼€å‘ç‰ˆæœ¬ï¼ˆå¿«é€Ÿç¼–è¯‘ï¼‰
cargo build

# å‘å¸ƒç‰ˆæœ¬ï¼ˆä¼˜åŒ–æ€§èƒ½å’Œä½“ç§¯ï¼‰
cargo build --release

# è°ƒè¯•ç‰ˆæœ¬ï¼ˆåŒ…å«ç¬¦å·ä¿¡æ¯ï¼‰
cargo build

# è‡ªå®šä¹‰ä¼˜åŒ–
CARGO_PROFILE_RELEASE_OPT_LEVEL=z cargo build --release
```

## ğŸ”§ å¼€å‘

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test test_parse_config

# æ˜¾ç¤ºæµ‹è¯•è¾“å‡º
cargo test -- --nocapture
```

### ä»£ç ç»“æ„

```
src/
â”œâ”€â”€ main.rs          # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ lib.rs           # å…¬å…±ç±»å‹å’Œå·¥å…·
â”œâ”€â”€ cli.rs           # å‘½ä»¤è¡Œå‚æ•°è§£æ
â”œâ”€â”€ config.rs        # é…ç½®æ–‡ä»¶ç®¡ç†
â”œâ”€â”€ downloader.rs    # ä¸‹è½½å™¨æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ exif.rs          # EXIF å…ƒæ•°æ®ä¿®æ”¹
â”œâ”€â”€ filename.rs      # æ–‡ä»¶åæ ¼å¼åŒ–
â”œâ”€â”€ fileops.rs       # æ–‡ä»¶æ“ä½œ
â””â”€â”€ error.rs         # é”™è¯¯ç±»å‹å®šä¹‰
```

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ LICENSE æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issueã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

- [tokio](https://tokio.rs/) - å¼‚æ­¥è¿è¡Œæ—¶
- [reqwest](https://docs.rs/reqwest/) - HTTP å®¢æˆ·ç«¯
- [clap](https://docs.rs/clap/) - å‘½ä»¤è¡Œå‚æ•°è§£æ
- [chrono](https://docs.rs/chrono/) - æ—¥æœŸæ—¶é—´å¤„ç†
- [little_exif](https://docs.rs/little_exif/) - EXIF è¯»å†™
- [tracing](https://docs.rs/tracing/) - ç»“æ„åŒ–æ—¥å¿—
- [indicatif](https://docs.rs/indicatif/) - è¿›åº¦æ¡æ˜¾ç¤º